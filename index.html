<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explora√ß√£o Pirata - RPG</title>
    <link rel="preload" as="image" href="https://raw.githubusercontent.com/rodfranbr/rpgpirata/refs/heads/main/background.jpeg">
    <link rel="preload" as="image" href="https://raw.githubusercontent.com/rodfranbr/rpgpirata/refs/heads/main/navegando0001.jpeg">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pirata+One&family=Cinzel:wght@400;700&family=Spectral:wght@400;600&display=swap');
        
        body {
            font-family: 'Spectral', serif;
            background: url('https://raw.githubusercontent.com/rodfranbr/rpgpirata/refs/heads/main/background.jpeg') no-repeat center center fixed;
            background-color: #0d1b2a;
            background-size: cover;
            color: #f0d6a8;
            margin: 0;
            padding: 0;
            line-height: 1.6;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.8);
        }
        
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0d1b2a;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s;
        }
        
        .compass {
            width: 80px;
            height: 80px;
            border: 4px solid #f0d6a8;
            border-radius: 50%;
            position: relative;
            animation: rotate 2s infinite linear;
        }
        
        .compass:before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 4px;
            height: 40px;
            background: #e63946;
            transform: translate(-50%, -50%);
            transform-origin: bottom center;
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        #loading-text {
            margin-top: 20px;
            font-size: 1.5rem;
            letter-spacing: 2px;
        }
        
        #game-container {
            max-width: 95%;
            margin: 20px auto;
            padding: 20px;
            background: rgba(13, 27, 42, 0.85);
            border-radius: 15px;
            box-shadow: 0 0 25px rgba(240, 214, 168, 0.3);
            border: 2px solid #975a16;
        }
        
        #game-title {
            font-family: 'Pirata One', cursive;
            text-align: center;
            font-size: 3rem;
            margin: 0 0 20px;
            color: #e63946;
            text-shadow: 2px 2px 4px #000;
            letter-spacing: 3px;
        }
        
        #image-display {
            text-align: center;
            margin-bottom: 20px;
            height: 60vh;
            max-height: 500px;
            overflow: hidden;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.7);
        }
        
        #game-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s;
        }
        
        #game-image:hover {
            transform: scale(1.03);
        }
        
        #status-bar {
            display: flex;
            justify-content: space-between;
            background: rgba(9, 19, 30, 0.9);
            padding: 10px 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-family: 'Cinzel', serif;
            font-weight: 700;
            border: 1px solid #975a16;
        }
        
        #gold-display {
            color: #ffd700;
            font-size: 1.3rem;
            text-shadow: 0 0 8px rgba(255, 215, 0, 0.6);
        }
        
        #timer-display {
            font-size: 1.3rem;
            color: #f0d6a8;
        }
        
        #console {
            background: rgba(9, 19, 30, 0.8);
            padding: 15px;
            border-radius: 8px;
            max-height: 250px;
            overflow-y: auto;
            margin-bottom: 15px;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
            border: 1px solid #975a16;
            scrollbar-width: thin;
            scrollbar-color: #975a16 rgba(9, 19, 30, 0.8);
        }
        
        #console p {
            margin: 8px 0;
            font-size: 1.1rem;
        }
        
        .event-title {
            color: #e63946;
            font-weight: bold;
            font-size: 1.3rem !important;
            border-bottom: 1px solid #975a16;
            padding-bottom: 5px;
            margin-top: 15px !important;
        }
        
        .highlight {
            color: #ffd700;
            font-weight: bold;
        }
        
        .gold-cost {
            color: #ffd700;
        }
        
        #action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        
        button {
            background: linear-gradient(to bottom, #975a16, #794612);
            color: #f0d6a8;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
            text-transform: uppercase;
            letter-spacing: 1px;
            border: 1px solid #b38728;
        }
        
        button:hover {
            background: linear-gradient(to bottom, #b38728, #975a16);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.5);
        }
        
        button:active {
            transform: translateY(1px);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }
        
        button:disabled {
            background: #5a5a5a;
            cursor: not-allowed;
            opacity: 0.7;
            box-shadow: none;
        }
        
        .gold-gained {
            animation: goldPulse 1s;
        }
        
        .damage-taken {
            animation: damagePulse 1s;
        }
        
        @keyframes goldPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); color: #ffd700; }
            100% { transform: scale(1); }
        }
        
        @keyframes damagePulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); color: #e63946; }
            100% { transform: scale(1); }
        }
        
        .treasure-found #console {
            animation: treasureGlow 1.5s;
        }
        
        @keyframes treasureGlow {
            0%, 100% { box-shadow: 0 0 10px rgba(255, 215, 0, 0.1); }
            50% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.8); }
        }
        
        .storm-active #game-container {
            animation: stormShake 0.5s infinite;
        }
        
        @keyframes stormShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(9, 19, 30, 0.6);
        }
        
        ::-webkit-scrollbar-thumb {
            background: #975a16;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #b38728;
        }
        
        @media (max-width: 768px) {
            #game-title {
                font-size: 2rem;
            }
            
            #image-display {
                height: 40vh;
            }
            
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div id="loading-overlay">
        <div class="compass"></div>
        <div id="loading-text">Carregando os mares...</div>
    </div>
    
    <div id="game-container">
        <h1 id="game-title">üè¥‚Äç‚ò†Ô∏è Explora√ß√£o Pirata üè¥‚Äç‚ò†Ô∏è</h1>
        
        <div id="image-display">
            <img id="game-image" src="https://raw.githubusercontent.com/rodfranbr/rpgpirata/refs/heads/main/navegando0001.jpeg" alt="Navio pirata">
        </div>
        
        <div id="status-bar">
            <div id="gold-display">1000 ouros</div>
            <div id="timer-display"></div>
        </div>
        
        <div id="console">
            <p>Bem-vindo ao mar dos saqueadores, Capit√£o! Seu navio est√° pronto para zarpar em busca de fortuna e gl√≥ria.</p>
            <p>Voc√™ come√ßa sua jornada com 1000 moedas de ouro. Use-as com sabedoria!</p>
            <p>Que os ventos soprem a seu favor. Est√° pronto para uma aventura pirata?</p>
        </div>
        
        <div id="action-buttons">
            <button id="explore-button">INICIAR Explora√ß√£o Mar√≠tima (custo: <span class="gold-cost">10 ouros</span>)</button>
        </div>
    </div>

    <script src="events.js"></script>
    <script>
        // Vari√°veis globais
        let playerGold = 1000, isExploring = false, explorationTimer = null, eventTimer = null, 
            currentCountdown = 0, explorationImages = [...Array(7)].map((_, i) => 
            `https://raw.githubusercontent.com/rodfranbr/rpgpirata/refs/heads/main/navegando000${i+1}.jpeg`);
        
        // DOM Elements
        const $ = id => document.getElementById(id),
              goldDisplay = $('gold-display'),
              consoleElement = $('console'),
              actionButtons = $('action-buttons'),
              exploreButton = $('explore-button'),
              timerDisplay = $('timer-display'),
              gameImage = $('game-image'),
              loadingOverlay = $('loading-overlay');
        
        // Sistema de armazenamento - Salvar/Carregar
        const saveGame = () => {
            try {
                localStorage.setItem('pirateRPGSave', JSON.stringify({
                    gold: playerGold,
                    lastSaved: new Date().toISOString()
                }));
            } catch (e) { console.log('Erro ao salvar: ', e); }
        };

        const loadGame = () => {
            try {
                const saved = localStorage.getItem('pirateRPGSave');
                if (saved) {
                    const data = JSON.parse(saved);
                    playerGold = data.gold;
                    updateGoldDisplay();
                    logMessage(`Jogo carregado! √öltima jogada: ${new Date(data.lastSaved).toLocaleString()}`);
                }
            } catch (e) { console.log('Erro ao carregar: ', e); }
        };

        // Pr√©-carregamento de imagens
        const preloadImages = () => {
            const imagesToPreload = [
                ...explorationImages,
                ...events.flatMap(event => {
                    const imgs = event.images || [];
                    event.actions.forEach(action => {
                        if (action.image) imgs.push(action.image);
                        if (action.result) {
                            const r = action.result;
                            ['image', 'treasureImage', 'emptyChestImage', 
                             'noTreasureImage', 'successImage', 'failureImage']
                                .forEach(prop => { if (r[prop]) imgs.push(r[prop]); });
                        }
                    });
                    return imgs;
                })
            ];
            
            imagesToPreload.forEach(src => new Image().src = src);
        };
        
        // Fun√ß√µes de atualiza√ß√£o UI
        function updateGoldDisplay() {
            goldDisplay.textContent = `${playerGold} ouros`;
            goldDisplay.classList.remove('gold-gained', 'damage-taken');
            void goldDisplay.offsetWidth;
        }
        
        function updateGoldWithAnimation(amount) {
            playerGold += amount;
            updateGoldDisplay();
            goldDisplay.classList.add(amount > 0 ? 'gold-gained' : amount < 0 ? 'damage-taken' : '');
            saveGame();
        }
        
        function logMessage(message, isEventTitle = false) {
            const p = document.createElement('p');
            if (isEventTitle) p.classList.add('event-title');
            p.innerHTML = message;
            consoleElement.appendChild(p);
            consoleElement.scrollTop = consoleElement.scrollHeight;
        }
        
        // Fun√ß√µes de navega√ß√£o
        function startExploration() {
            if (playerGold < 10) {
                return logMessage("Voc√™ n√£o tem ouro suficiente para explorar! (custo: 10 ouros)");
            }
            
            updateGoldWithAnimation(-10);
            actionButtons.innerHTML = '';
            
            const stopButton = document.createElement('button');
            stopButton.textContent = "Parar Explora√ß√£o";
            stopButton.addEventListener('click', stopExploration);
            actionButtons.appendChild(stopButton);
            
            isExploring = true;
            logMessage("Seu navio zarpou em busca de aventuras! A cada 60 segundos, algo poder√° acontecer...");
            
            rotateNavigationImages();
            explorationTimer = setInterval(checkForEvent, 60000);
            setInterval(showRandomNavigationMessage, 10000);
        }
        
        function stopExploration() {
            if (!isExploring) return;
            
            clearInterval(explorationTimer);
            if (eventTimer) clearTimeout(eventTimer);
            
            isExploring = false;
            
            actionButtons.innerHTML = '';
            const exploreBtn = document.createElement('button');
            exploreBtn.id = 'explore-button';
            exploreBtn.innerHTML = `INICIAR Explora√ß√£o Mar√≠tima (custo: <span class="gold-cost">10 ouros</span>)`;
            exploreBtn.addEventListener('click', startExploration);
            actionButtons.appendChild(exploreBtn);
            
            logMessage("Voc√™ interrompeu sua explora√ß√£o e retornou ao porto.");
            timerDisplay.textContent = '';
            saveGame();
        }
        
        function rotateNavigationImages() {
            if (!isExploring) return;
            gameImage.src = explorationImages[Math.floor(Math.random() * explorationImages.length)];
            setTimeout(rotateNavigationImages, 5000);
        }
        
        function showRandomNavigationMessage() {
            if (!isExploring || document.querySelector('#action-buttons button').textContent !== "Parar Explora√ß√£o") return;
            logMessage(navigationMessages[Math.floor(Math.random() * navigationMessages.length)]);
        }
        
        // Fun√ß√µes de eventos
        function checkForEvent() {
            if (!isExploring) return;
            
            if (Math.random() * 100 <= 10) {
                determineEvent();
            } else {
                logMessage("Nada de interessante no horizonte. A jornada continua...");
            }
        }
        
        function determineEvent() {
            const roll = Math.random() * 100;
            const totalChance = events.reduce((sum, e) => sum + e.chance, 0);
            
            let threshold = 0;
            for (const event of events) {
                threshold += (event.chance / totalChance) * 100;
                if (roll <= threshold) {
                    triggerEvent(event);
                    return;
                }
            }
        }
        
        function triggerEvent(event) {
            clearInterval(explorationTimer);
            
            logMessage(event.title, true);
            logMessage(event.descriptions[Math.floor(Math.random() * event.descriptions.length)]);
            
            if (event.images && event.images.length) {
                gameImage.src = event.images[Math.floor(Math.random() * event.images.length)];
            }
            
            actionButtons.innerHTML = '';
            
            event.actions.forEach(action => {
                const button = document.createElement('button');
                button.innerHTML = `${action.name} ${action.cost > 0 ? `(custo: <span class="gold-cost">${action.cost} ouros</span>)` : ''}`;
                
                if (action.cost > playerGold) {
                    button.disabled = true;
                    button.title = "Ouro insuficiente";
                }
                
                button.addEventListener('click', () => executeAction(action, event));
                actionButtons.appendChild(button);
            });
        }
        
        function executeAction(action, parentEvent) {
            if (action.cost > 0) {
                updateGoldWithAnimation(-action.cost);
                logMessage(`Voc√™ gastou <span class="gold-cost">${action.cost} ouros</span> para ${action.name.toLowerCase()}.`);
            }
            
            actionButtons.innerHTML = '';
            if (action.image) gameImage.src = action.image;
            
            startCountdown(action.duration, () => processActionResult(action, parentEvent));
            logMessage(action.startMessage || `Aguarde enquanto ${action.name.toLowerCase()}...`);
        }
        
        function startCountdown(seconds, callback) {
            currentCountdown = seconds;
            updateTimerDisplay();
            
            eventTimer = setInterval(() => {
                currentCountdown--;
                updateTimerDisplay();
                
                if (currentCountdown <= 0) {
                    clearInterval(eventTimer);
                    eventTimer = null;
                    timerDisplay.textContent = '';
                    callback();
                }
            }, 1000);
        }
        
        function updateTimerDisplay() {
            timerDisplay.textContent = `${Math.floor(currentCountdown / 60)}:${(currentCountdown % 60).toString().padStart(2, '0')}`;
        }
        
        function processActionResult(action, parentEvent) {
            const result = calculateResult(action);
            
            if (result.gold !== 0) {
                updateGoldWithAnimation(result.gold);
                const goldMessage = result.gold > 0 
                    ? `Voc√™ ganhou <span class="highlight">+${result.gold} ouros</span>!` 
                    : `Voc√™ perdeu <span class="highlight">${Math.abs(result.gold)} ouros</span>!`;
                logMessage(goldMessage);
            }
            
            logMessage(result.message);
            if (result.image) gameImage.src = result.image;
            
            resetToExploration();
            
            if (result.gold > 100) {
                consoleElement.classList.add('treasure-found');
                setTimeout(() => consoleElement.classList.remove('treasure-found'), 3000);
            }
            
            if (parentEvent.id === 'tempestade') {
                $('game-container').classList.add('storm-active');
                setTimeout(() => $('game-container').classList.remove('storm-active'), 3000);
            }
        }
        
        function calculateResult(action) {
            const roll = Math.random() * 100;
            const randomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
            
            let resultObj = { gold: 0, message: "Nada aconteceu.", image: null };
            
            if (action.result) {
                if (action.result.type === 'chance') {
                    if (roll <= action.result.successChance) {
                        resultObj.gold = randomInt(action.result.successGoldMin, action.result.successGoldMax);
                        resultObj.message = action.result.successMessage;
                        resultObj.image = action.result.successImage;
                    } else {
                        if (action.result.failureGoldPercent) {
                            const lossPercent = randomInt(action.result.failureGoldPercent.min, action.result.failureGoldPercent.max);
                            resultObj.gold = -Math.floor(playerGold * (lossPercent / 100));
                        } else if (action.result.failureGoldMin !== undefined) {
                            resultObj.gold = -randomInt(action.result.failureGoldMin, action.result.failureGoldMax);
                        }
                        resultObj.message = action.result.failureMessage;
                        resultObj.image = action.result.failureImage;
                    }
                } else if (action.result.type === 'loot') {
                    if (roll <= action.result.findChance) {
                        resultObj.gold = randomInt(action.result.goldMin, action.result.goldMax);
                        
                        if (resultObj.gold <= action.cost) {
                            resultObj.image = action.result.emptyChestImage;
                            resultObj.message = "Voc√™ encontrou um ba√∫, mas ele cont√©m pouco ouro. Mal cobre seus custos!";
                        } else {
                            resultObj.image = action.result.treasureImage;
                            resultObj.message = "Voc√™ encontrou um ba√∫ cheio de ouro! Sua sorte est√° lan√ßada!";
                        }
                    } else {
                        resultObj.gold = 0;
                        resultObj.image = action.result.noTreasureImage;
                        resultObj.message = "Voc√™ escavou bastante, mas n√£o encontrou nenhum tesouro.";
                    }
                } else if (action.result.type === 'resource') {
                    resultObj.gold = randomInt(action.result.goldMin, action.result.goldMax);
                    resultObj.message = action.result.message;
                    resultObj.image = action.result.image;
                }
            }
            
            return resultObj;
        }
        
        function resetToExploration() {
            actionButtons.innerHTML = '';
            
            const continueButton = document.createElement('button');
            continueButton.textContent = "Continuar Explora√ß√£o";
            continueButton.addEventListener('click', () => {
                logMessage("Sua tripula√ß√£o est√° descansada e pronta para continuar a explora√ß√£o!");
                
                actionButtons.innerHTML = '';
                const stopButton = document.createElement('button');
                stopButton.textContent = "Parar Explora√ß√£o";
                stopButton.addEventListener('click', stopExploration);
                actionButtons.appendChild(stopButton);
                
                explorationTimer = setInterval(checkForEvent, 60000);
                rotateNavigationImages();
            });
            actionButtons.appendChild(continueButton);
            
            const returnButton = document.createElement('button');
            returnButton.textContent = "Retornar ao Porto";
            returnButton.addEventListener('click', () => {
                isExploring = false;
                logMessage("Voc√™ decidiu retornar ao porto ap√≥s sua aventura.");
                
                actionButtons.innerHTML = '';
                const exploreBtn = document.createElement('button');
                exploreBtn.id = 'explore-button';
                exploreBtn.innerHTML = `INICIAR Explora√ß√£o Mar√≠tima (custo: <span class="gold-cost">10 ouros</span>)`;
                exploreBtn.addEventListener('click', startExploration);
                actionButtons.appendChild(exploreBtn);
                
                saveGame();
            });
            actionButtons.appendChild(returnButton);
        }
        
        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', () => {
            loadGame();
            updateGoldDisplay();
            preloadImages();
            
            setTimeout(() => {
                loadingOverlay.style.opacity = '0';
                setTimeout(() => loadingOverlay.style.display = 'none', 500);
            }, 2000);
            
            exploreButton.addEventListener('click', startExploration);
            setInterval(saveGame, 60000);
        });
    </script>
</body>
</html>
